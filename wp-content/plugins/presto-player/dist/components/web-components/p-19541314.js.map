{"version":3,"names":["prevent_default","event","preventDefault","toggle_mark_complete","enabled","$form","jQuery","$btn","$links","off","removeAttr","removeClass","on","attr","addClass","getEventMeta","player","eventMeta","ts","currentTime","duration","url","source","provider","id","config","track_event","event_id","meta","llms","tracking","addEvent","start_countdown","$el","$seconds","find","time","setInterval","text","closest","click","do_ajax_completion","settings","LLMS","Ajax","call","data","action","post_id","nonce","beforeSend","Spinner","start","error","xhr","status","stop","console","responseText","log","success","res","html","append","onPauseVideo","e","detail","plyr","onPlayingVideo","onEndedVideo","lifter","tracking_settings","getSettings","av","require_video_completion","video_completed"],"sources":["src/components/core/player/integrations/lifter/helper.js","src/components/core/player/integrations/lifter/lifter.js"],"sourcesContent":["// Mark Complete Button\nconst prevent_default = event => {\n  event.preventDefault();\n};\n\nfunction toggle_mark_complete(enabled) {\n  var $form = jQuery('.llms-complete-lesson-form'),\n    $btn = jQuery('.llms-complete-lesson-form button[type=\"submit\"]'),\n    $links = jQuery('#llms_start_quiz, #llms-start-assignment');\n\n  if (true === enabled) {\n    $form.off('submit', prevent_default);\n    $btn.removeAttr('disabled');\n    $links.removeClass('llms-av-disabled').off('click', prevent_default);\n  } else {\n    $form.on('submit', prevent_default);\n    $btn.attr('disabled', 'disabled');\n    $links.addClass('llms-av-disabled').on('click', prevent_default);\n  }\n}\n\n// Setting and Getting Event meta data\nconst getEventMeta = player => {\n  let eventMeta = {\n    ts: player.currentTime,\n    duration: player.duration,\n    url: player.source,\n    provider: player.provider,\n    id: player.config.id,\n  };\n  return eventMeta;\n};\n\n// tracking event\nconst track_event = (event_id, meta) => {\n  llms.tracking.addEvent('video.' + event_id, {\n    meta: meta,\n  });\n};\n\n// ajax call\nfunction start_countdown($el) {\n  var $seconds = $el.find('.llms-av-pv--seconds'),\n    time;\n\n  setInterval(function () {\n    time = $seconds.text() * 1 - 1;\n    if (1 === time) {\n      $seconds.closest('a')[0].click();\n    }\n\n    if (time >= 0) {\n      $seconds.text(time);\n    }\n  }, 1000);\n}\n\nfunction do_ajax_completion($el, settings) {\n  LLMS.Ajax.call({\n    data: {\n      action: 'llms_av_video_ended',\n      id: settings.post_id,\n      nonce: settings.nonce,\n    },\n    beforeSend: function () {\n      LLMS.Spinner.start($el);\n    },\n    error: function (xhr, status, error) {\n      LLMS.Spinner.stop($el);\n      console.error(xhr.responseText + ' (' + error + ' ' + status + ')'); /* eslint-disable-line no-console */\n      console.log(xhr); /* eslint-disable-line no-console */\n    },\n    success: function (res) {\n      LLMS.Spinner.stop($el);\n      if (res?.html) {\n        $el.append(res.html);\n        start_countdown($el);\n      }\n    },\n  });\n}\n\nexport { getEventMeta, track_event, toggle_mark_complete, do_ajax_completion };\n","import { getEventMeta, track_event, toggle_mark_complete, do_ajax_completion } from './helper';\n\nexport const onPauseVideo = e => {\n  const player = e.detail.plyr;\n  let eventMeta = getEventMeta(player);\n  track_event('paused', eventMeta);\n};\n\nexport const onPlayingVideo = e => {\n  const player = e.detail.plyr;\n  let eventMeta = getEventMeta(player);\n  let event_id = eventMeta.ts < 1 ? 'started' : 'played';\n  track_event(event_id, eventMeta);\n};\n\nexport const onEndedVideo = (e, $el, settings) => {\n  const player = e.detail.plyr;\n  let eventMeta = getEventMeta(player);\n\n  track_event('ended', eventMeta);\n  do_ajax_completion($el, settings);\n  toggle_mark_complete(true);\n};\n\nexport default function (player) {\n  /*\n    Below code is coped from LifterLMS-Advanced-Videos/assets/js/llms.av.js\n    We replaced $ with jQuery.\n  */\n  var settings = {};\n  var tracking_settings = llms?.tracking?.getSettings() || null;\n\n  if (tracking_settings?.av) {\n    settings = tracking_settings.av;\n  }\n\n  /*\n    LifterLMS-Advanced-Videos copied code end.\n    Below code will glue the LifterAV with Presto player.\n  */\n  if (settings.require_video_completion && !settings.video_completed) {\n    toggle_mark_complete(false);\n  }\n\n  let $el = jQuery('.presto-block-video');\n\n  // on end, sync time and autoload content\n  player.on('pause', onPauseVideo);\n  player.on('playing', onPlayingVideo);\n  player.on('ended', e => onEndedVideo(e, $el, settings));\n}\n"],"mappings":"AACA,MAAMA,EAAkBC,IACtBA,EAAMC,gBAAgB,EAGxB,SAASC,EAAqBC,GAC5B,IAAIC,EAAQC,OAAO,8BACjBC,EAAOD,OAAO,oDACdE,EAASF,OAAO,4CAElB,GAAI,OAASF,EAAS,CACpBC,EAAMI,IAAI,SAAUT,GACpBO,EAAKG,WAAW,YAChBF,EAAOG,YAAY,oBAAoBF,IAAI,QAAST,EACxD,KAAS,CACLK,EAAMO,GAAG,SAAUZ,GACnBO,EAAKM,KAAK,WAAY,YACtBL,EAAOM,SAAS,oBAAoBF,GAAG,QAASZ,EACpD,CACA,CAGA,MAAMe,EAAeC,IACnB,IAAIC,EAAY,CACdC,GAAIF,EAAOG,YACXC,SAAUJ,EAAOI,SACjBC,IAAKL,EAAOM,OACZC,SAAUP,EAAOO,SACjBC,GAAIR,EAAOS,OAAOD,IAEpB,OAAOP,CAAS,EAIlB,MAAMS,EAAc,CAACC,EAAUC,KAC7BC,KAAKC,SAASC,SAAS,SAAWJ,EAAU,CAC1CC,KAAMA,GACN,EAIJ,SAASI,EAAgBC,GACvB,IAAIC,EAAWD,EAAIE,KAAK,wBACtBC,EAEFC,aAAY,WACVD,EAAOF,EAASI,OAAS,EAAI,EAC7B,GAAI,IAAMF,EAAM,CACdF,EAASK,QAAQ,KAAK,GAAGC,OAC/B,CAEI,GAAIJ,GAAQ,EAAG,CACbF,EAASI,KAAKF,EACpB,CACA,GAAK,IACL,CAEA,SAASK,EAAmBR,EAAKS,GAC/BC,KAAKC,KAAKC,KAAK,CACbC,KAAM,CACJC,OAAQ,sBACRvB,GAAIkB,EAASM,QACbC,MAAOP,EAASO,OAElBC,WAAY,WACVP,KAAKQ,QAAQC,MAAMnB,EACzB,EACIoB,MAAO,SAAUC,EAAKC,EAAQF,GAC5BV,KAAKQ,QAAQK,KAAKvB,GAClBwB,QAAQJ,MAAMC,EAAII,aAAe,KAAOL,EAAQ,IAAME,EAAS,KAC/DE,QAAQE,IAAIL,EAClB,EACIM,QAAS,SAAUC,GACjBlB,KAAKQ,QAAQK,KAAKvB,GAClB,GAAI4B,GAAKC,KAAM,CACb7B,EAAI8B,OAAOF,EAAIC,MACf9B,EAAgBC,EACxB,CACA,GAEA,CC9EY,MAAC+B,EAAeC,IAC1B,MAAMjD,EAASiD,EAAEC,OAAOC,KACxB,IAAIlD,EAAYF,EAAaC,GAC7BU,EAAY,SAAUT,EAAU,EAGtB,MAACmD,EAAiBH,IAC5B,MAAMjD,EAASiD,EAAEC,OAAOC,KACxB,IAAIlD,EAAYF,EAAaC,GAC7B,IAAIW,EAAWV,EAAUC,GAAK,EAAI,UAAY,SAC9CQ,EAAYC,EAAUV,EAAU,EAGtB,MAACoD,EAAe,CAACJ,EAAGhC,EAAKS,KACnC,MAAM1B,EAASiD,EAAEC,OAAOC,KACxB,IAAIlD,EAAYF,EAAaC,GAE7BU,EAAY,QAAST,GACrBwB,EAAmBR,EAAKS,GACxBvC,EAAqB,KAAK,EAGb,SAAAmE,EAAUtD,GAKvB,IAAI0B,EAAW,GACf,IAAI6B,EAAoB1C,MAAMC,UAAU0C,eAAiB,KAEzD,GAAID,GAAmBE,GAAI,CACzB/B,EAAW6B,EAAkBE,EACjC,CAME,GAAI/B,EAASgC,2BAA6BhC,EAASiC,gBAAiB,CAClExE,EAAqB,MACzB,CAEE,IAAI8B,EAAM3B,OAAO,uBAGjBU,EAAOJ,GAAG,QAASoD,GACnBhD,EAAOJ,GAAG,UAAWwD,GACrBpD,EAAOJ,GAAG,SAASqD,GAAKI,EAAaJ,EAAGhC,EAAKS,IAC/C,Q"}