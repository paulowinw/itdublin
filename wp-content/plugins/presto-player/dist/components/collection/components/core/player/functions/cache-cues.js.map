{"version":3,"file":"cache-cues.js","sourceRoot":"","sources":["../../../../../src/components/core/player/functions/cache-cues.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,MAAM,MAAM,CAAC;AACtB,OAAO,EAAE,SAAS,EAAE,MAAM,cAAc,CAAC;AACzC,MAAM,CAAC,OAAO,UAAU,SAAS,CAAC,MAAM;;IACtC,iCAAiC;IACjC,IAAI,CAAC,CAAA,MAAA,MAAA,MAAM,aAAN,MAAM,uBAAN,MAAM,CAAE,MAAM,CAAC,MAAM,0CAAE,MAAM,0CAAE,OAAO,CAAA;QAAE,OAAO;IACpD,wCAAwC;IACxC,IAAI,CAAC,CAAA,MAAA,MAAA,MAAM,aAAN,MAAM,uBAAN,MAAM,CAAE,KAAK,0CAAE,UAAU,0CAAE,MAAM,CAAA,IAAI,CAAA,MAAA,MAAA,MAAM,aAAN,MAAM,uBAAN,MAAM,CAAE,KAAK,0CAAE,UAAU,0CAAE,MAAM,MAAK,CAAC;QAAE,OAAO;IAC1F,mDAAmD;IACnD,IAAI,CAAA,MAAM,aAAN,MAAM,uBAAN,MAAM,CAAE,YAAY,MAAK,CAAC,CAAC;QAAE,OAAO;IAExC,yCAAyC;IACzC,MAAM,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC;IAE5B,IAAI,QAAQ,GAAG,WAAW,CAAC,GAAG,EAAE;;QAC9B,MAAM,aAAa,GAAG,MAAA,MAAM,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC,CAAC,0CAAE,IAAI,CAAC;QAEvD,IAAI,CAAA,aAAa,aAAb,aAAa,uBAAb,aAAa,CAAE,MAAM,IAAG,CAAC,EAAE,CAAC;YAC9B,8BAA8B;YAC9B,OAAO,CAAC,MAAM,CAAC,CAAC;YAChB,2BAA2B;YAC3B,MAAM,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC;YAE7B,aAAa,CAAC,QAAQ,CAAC,CAAC;QAC1B,CAAC;IACH,CAAC,EAAE,GAAG,CAAC,CAAC;AACV,CAAC;AAED,MAAM,UAAU,OAAO,CAAC,MAAM;IAC5B,IAAI,CAAC,MAAM;QAAE,OAAO;IACpB,MAAM,iBAAiB,GAAG,YAAY,CAAC,OAAO,CAAC,gBAAgB,GAAG,MAAM,CAAC,EAAE,GAAG,OAAO,CAAC,CAAC;IAEvF,IAAI,EAAE,CAAC,KAAK,CAAC,iBAAiB,CAAC;QAAE,OAAO,EAAE,CAAC;IAE3C,OAAO,IAAI,CAAC,KAAK,CAAC,iBAAiB,CAAC,CAAC;AACvC,CAAC;AAED,MAAM,UAAU,OAAO,CAAC,MAAM;;IAC5B,IACE,CAAC,MAAM;QACP,CAAC,CAAA,MAAA,MAAM,aAAN,MAAM,uBAAN,MAAM,CAAE,KAAK,0CAAE,UAAU,CAAA;QAC1B,CAAA,MAAA,MAAA,MAAM,aAAN,MAAM,uBAAN,MAAM,CAAE,KAAK,0CAAE,UAAU,0CAAE,MAAM,MAAK,CAAC;QACvC,OAAO;IAET,MAAM,IAAI,GAAG,CAAC,MAAA,MAAA,MAAM,aAAN,MAAM,uBAAN,MAAM,CAAE,KAAK,0CAAE,UAAU,0CAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,MAAM,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;IAC3F,IAAK,CAAC,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,EAAG,CAAC;QACtB,YAAY,CAAC,OAAO,CAAC,gBAAgB,GAAG,MAAM,CAAC,EAAE,GAAG,OAAO,EAAE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC;IACrF,CAAC;AAEH,CAAC","sourcesContent":["import is from './is';\nimport { vttToJson } from './search-vtt';\nexport default function cacheCues(player) {\n  // Bail is search is not enabled.\n  if (!player?.config.preset?.search?.enabled) return;\n  // Bail if no language tracks are added.\n  if (!player?.media?.textTracks?.length || player?.media?.textTracks?.length === 0) return;\n  // Bail if already a track is selected by the user.\n  if (player?.currentTrack !== -1) return;\n\n  // Cache the default 1st available track.\n  player.toggleCaptions(true);\n\n  let interval = setInterval(() => {\n    const generatedCues = player.media.textTracks[0]?.cues;\n\n    if (generatedCues?.length > 0) {\n      // Cache it into localstorage.\n      setCues(player);\n      // Reset to original track.\n      player.toggleCaptions(false);\n\n      clearInterval(interval);\n    }\n  }, 200);\n}\n\nexport function getCues(player) {\n  if (!player) return;\n  const locallyStoredCues = localStorage.getItem('presto-player-' + player.id + '-cues');\n\n  if (is.empty(locallyStoredCues)) return '';\n\n  return JSON.parse(locallyStoredCues);\n}\n\nexport function setCues(player) {\n  if (\n    !player ||\n    !player?.media?.textTracks ||\n    player?.media?.textTracks?.length === 0\n  ) return;\n  \n  const cues = (player?.media?.textTracks?.[0]) ? vttToJson(player.media.textTracks[0]) : {};\n  if ( !is.empty(cues) ) {\n    localStorage.setItem('presto-player-' + player.id + '-cues', JSON.stringify(cues));\n  }\n  \n}\n"]}