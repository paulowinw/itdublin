{"version":3,"file":"presto-action-bar-controller.js","sourceRoot":"","sources":["../../../../../../src/components/core/features/presto-action-bar/controller/presto-action-bar-controller.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Element, Event, EventEmitter, h, Prop, State, Watch } from '@stencil/core';\nimport { ActionBarConfig, YoutubeConfig } from '../../../../../interfaces';\nimport { timePassed } from '../../../../../util';\n\n@Component({\n  tag: 'presto-action-bar-controller',\n  styleUrl: 'presto-action-bar-controller.scss',\n  shadow: true,\n})\nexport class PrestoActionBar {\n  @Element() el: HTMLElement;\n\n  @Prop() ended: boolean;\n  @Prop() config: ActionBarConfig;\n  @Prop({ reflect: true }) currentTime: number;\n  @Prop({ reflect: true }) duration: number;\n  @Prop() direction?: 'rtl';\n  @Prop() youtube?: YoutubeConfig;\n\n  @State() show: boolean = false;\n  @State() youtubeRenderKey: number = 1;\n  @State() percentagePassed: number = 0;\n  @Event() actionBarStateChange: EventEmitter<boolean>;\n\n  componentWillLoad() {\n    this.handleDuration();\n  }\n\n  /**\n   * Wait for duration to start before checking time\n   * @returns void\n   */\n  @Watch('duration')\n  handleDuration() {\n    this.handleTime();\n  }\n\n  /**\n   * Handle with the player is ended\n   * @param val\n   * @returns\n   */\n  @Watch('ended')\n  handleEnded(val) {\n    if (val) {\n      if (this?.config?.percentage_start !== 100) return;\n      this.show = true;\n    }\n  }\n\n  @Watch('currentTime')\n  @Watch('duration')\n  handlePercentagePassed() {\n    this.percentagePassed = (this.currentTime / this.duration) * 100;\n  }\n\n  /**\n   * When current time changes, check to see if we should\n   * enable the overlay\n   * @returns void\n   */\n  @Watch('currentTime')\n  handleTime() {\n    this.checkTime();\n  }\n\n  /**\n   * Set enabled/disabled based on time that has passed\n   */\n  checkTime() {\n    if (window?.wp?.blocks) {\n      this.show = true;\n      return;\n    }\n    // if ( this.config?.percentage_start === 0) {\n    //   this.show = true;\n    // } else {\n\n    // console.log(this.currentTime, this.duration, this.config?.percentage_start);\n    this.show = timePassed({\n      current: this.currentTime,\n      duration: this.duration,\n      showAfter: this.config?.percentage_start,\n    });\n  }\n\n  @Watch('config')\n  handleButtonCountChange(newVal, oldVal) {\n    if (newVal?.button_count !== oldVal?.button_count) {\n      this.youtubeRenderKey++;\n    }\n    if (newVal?.enabled) {\n      this.handleDuration();\n    }\n  }\n\n  youtubeButton() {\n    if (this.config?.button_type !== 'youtube' || !this.youtube?.channelId) {\n      return;\n    }\n\n    return <presto-youtube-subscribe-button key={this.youtubeRenderKey} channel={this.youtube?.channelId} showCount={this.config?.button_count}></presto-youtube-subscribe-button>;\n  }\n\n  customButton() {\n    if (this.config?.button_type !== 'custom') {\n      return;\n    }\n\n    return (\n      <presto-player-button\n        type=\"primary\"\n        size=\"small\"\n        href={this.config?.button_link?.url}\n        target={this.config?.button_link?.opensInNewTab ? '_blank' : '_self'}\n        style={{\n          '--presto-player-button-border-radius': `${this.config?.button_radius}px`,\n          ...(this.config?.button_color\n            ? {\n                '--presto-player-button-color': `${this.config?.button_color}`,\n              }\n            : {}),\n          ...(this.config?.button_text_color\n            ? {\n                '--presto-player-button-text': `${this.config?.button_text_color}`,\n              }\n            : {}),\n        }}\n      >\n        {this.config?.button_text}\n      </presto-player-button>\n    );\n  }\n  @Watch('show')\n  handleCtaStateChange(val) {\n    this.actionBarStateChange.emit(val);\n  }\n  render() {\n    return (\n      <presto-action-bar-ui\n        open={this.show}\n        style={{\n          '--presto-action-bar-background': this.config?.background_color || '#1d1d1d',\n        }}\n      >\n        {this.config?.text}\n\n        <div slot=\"button\">\n          {this.youtubeButton()}\n          {this.customButton()}\n        </div>\n      </presto-action-bar-ui>\n    );\n  }\n}\n"]}